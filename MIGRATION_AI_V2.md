# –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ —É–ª—É—á—à–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É AI –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (V2)

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

**–ü—É–±–ª–∏—á–Ω—ã–π API –ù–ï –∏–∑–º–µ–Ω–∏–ª—Å—è** - –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤—ã–∑–æ–≤—ã –ø—Ä–æ–¥–æ–ª–∂–∞—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.

**–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
1. `AiPromptService` - –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã `generateContentPlan()` –∏ `generateMustCover()`
2. `AiDraftService` - –¥–≤—É—Ö–ø—Ä–æ—Ö–æ–¥–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è + –ø–æ—Å—Ç-–ª–∏–Ω—Ç–µ—Ä
3. `AiOpenaiService` - –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ (temperature, frequency_penalty, top_p)
4. `ai.config.ts` - –Ω–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ refineEnabled –∏ qualityThreshold

### –î–ª—è DevOps

**–ù–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ, –∏–º–µ—é—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
AI_REFINE_ENABLED=false        # –í–∫–ª—é—á–∏—Ç—å –¥–≤—É—Ö–ø—Ä–æ—Ö–æ–¥–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
AI_QUALITY_THRESHOLD=0.7       # –ü–æ—Ä–æ–≥ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–ª—è refine (0.0-1.0)
```

## –®–∞–≥–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

### 1. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥

```bash
git pull origin main
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è)

```bash
npm install
```

### 3. –û–±–Ω–æ–≤–∏—Ç—å .env —Ñ–∞–π–ª

–î–æ–±–∞–≤–∏—Ç—å –≤ `.env` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

```bash
# AI Content Generation (–Ω–æ–≤–æ–µ)
AI_REFINE_ENABLED=false        # –û—Å—Ç–∞–≤—å—Ç–µ false –¥–ª—è –Ω–∞—á–∞–ª–∞
AI_QUALITY_THRESHOLD=0.7
```

### 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä

**Development:**
```bash
npm run start:dev
```

**Production:**
```bash
npm run build
npm run start:prod
```

### 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å:

```bash
POST http://localhost:4000/api/v1/listings/{id}/generate-draft
Content-Type: application/json

{
  "locale": "it-IT",
  "tone": "professionale",
  "length": "medium"
}
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- –°—Ç–∞—Ç—É—Å 200
- JSON —Å 5 –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞–º–∏ –≤ description
- 5-7 highlights
- –õ–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### 6. –í–∫–ª—é—á–∏—Ç—å refine (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –∫–∞—á–µ—Å—Ç–≤–æ —Ç–µ–∫—Å—Ç–æ–≤ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç, –Ω–æ —Ö–æ—á–µ—Ç—Å—è –µ—â—ë –ª—É—á—à–µ:

```bash
AI_REFINE_ENABLED=true
AI_QUALITY_THRESHOLD=0.7
```

**–í–ê–ñ–ù–û:** –≠—Ç–æ —É–≤–µ–ª–∏—á–∏—Ç —Ä–∞—Å—Ö–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤ –≤ ~1.5-2 —Ä–∞–∑–∞!

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞

### –í –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞ –∏—â–∏—Ç–µ:

```
[AiDraftService] Draft quality metrics {
  coverageScore: 0.85,
  structureValid: true,
  paragraphCount: 5,
  highlightsCount: 6,
  missingMustCover: []
}
```

**–•–æ—Ä–æ—à–∏–µ –º–µ—Ç—Ä–∏–∫–∏:**
- `coverageScore` > 0.7
- `structureValid: true`
- `paragraphCount: 5`
- `highlightsCount: 5-7`

**–ü–ª–æ—Ö–∏–µ –º–µ—Ç—Ä–∏–∫–∏:**
- `coverageScore` < 0.5
- `paragraphCount` !== 5
- `missingMustCover` –¥–ª–∏–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫

‚Üí –í–∫–ª—é—á–∏—Ç–µ `AI_REFINE_ENABLED=true`

## Rollback (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

```bash
git checkout <previous-commit>
npm install
npm run build
npm run start:prod
```

–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫–ª—é—á–∏—Ç–µ –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

```bash
AI_REFINE_ENABLED=false
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

1. **–í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:**
   - –ë–µ–∑ refine: ~2-5 —Å–µ–∫
   - –° refine: ~4-10 —Å–µ–∫

2. **–†–∞—Å—Ö–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤:**
   - –ë–µ–∑ refine: ~500-1500 tokens
   - –° refine: ~1000-3000 tokens

3. **–ö–∞—á–µ—Å—Ç–≤–æ (coverage score):**
   - –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: > 0.7
   - –û—Ç–ª–∏—á–Ω–æ: > 0.85

4. **–ß–∞—Å—Ç–æ—Ç–∞ refine:**
   - –ï—Å–ª–∏ > 50% –∑–∞–ø—Ä–æ—Å–æ–≤ —Ç—Ä–µ–±—É—é—Ç refine ‚Üí –Ω—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### Alerts

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞:
- –°—Ä–µ–¥–Ω–∏–π coverage score < 0.6 –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
- > 80% –∑–∞–ø—Ä–æ—Å–æ–≤ —Ç—Ä–µ–±—É—é—Ç refine pass
- –°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ > 15 —Å–µ–∫

## FAQ

### Q: –ù—É–∂–Ω–æ –ª–∏ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Ä–∞–∑—É?

A: –ù–µ—Ç, –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã. –ú–æ–∂–µ—Ç–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ.

### Q: –ò–∑–º–µ–Ω–∏—Ç—Å—è –ª–∏ —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API?

A: –ù–µ—Ç, —Ñ–æ—Ä–º–∞—Ç `ListingDraftDto` –æ—Å—Ç–∞–ª—Å—è –ø—Ä–µ–∂–Ω–∏–º.

### Q: –°—Ç–∞–Ω–µ—Ç –ª–∏ –º–µ–¥–ª–µ–Ω–Ω–µ–µ?

A: –° `AI_REFINE_ENABLED=false` - –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ (~5-10%).
–° `AI_REFINE_ENABLED=true` - –¥–∞, –≤ ~1.5-2 —Ä–∞–∑–∞ –º–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ –∫–∞—á–µ—Å—Ç–≤–æ –ª—É—á—à–µ.

### Q: –£–≤–µ–ª–∏—á–∏—Ç—Å—è –ª–∏ —Ä–∞—Å—Ö–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤?

A: –° `AI_REFINE_ENABLED=false` - –º–∏–Ω–∏–º–∞–ª—å–Ω–æ.
–° `AI_REFINE_ENABLED=true` - –¥–∞, –≤ ~1.5-2 —Ä–∞–∑–∞.

### Q: –ß—Ç–æ –µ—Å–ª–∏ —É –ª–∏—Å—Ç–∏–Ω–≥–∞ –º–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö?

A: –°–∏—Å—Ç–µ–º–∞ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è - –µ—Å–ª–∏ mustCover —ç–ª–µ–º–µ–Ω—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, –æ–Ω–∏ –Ω–µ –±—É–¥—É—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è. Fallback —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö.

### Q: –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç?

A: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ - –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å—Ç—Ä–æ–∫–∏:
```
[AiDraftService] Draft quality metrics ...
[AiDraftService] AI draft generated successfully { finalCoverageScore: 0.85 }
```

### Q: –ú–æ–≥—É –ª–∏ —è –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏?

A: –î–∞, —á–µ—Ä–µ–∑ git rollback –∏–ª–∏ –æ—Ç–∫–ª—é—á–∏–≤ –Ω–æ–≤—ã–µ —Ñ–∏—á–∏ —á–µ—Ä–µ–∑ ENV.

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–í–æ–ø—Ä–æ—Å—ã –∏ –ø—Ä–æ–±–ª–µ–º—ã:
- GitHub Issues: [—Å—Å—ã–ª–∫–∞]
- Email: [email]
- Slack: #ai-realtor-support

## Changelog

**v2.0.0 - AI Content Generation Upgrade**
- ‚ú® –ö–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω —Å 5 —Å–µ–∫—Ü–∏—è–º–∏ –∏ —Ü–µ–ª–µ–≤—ã–º–∏ –æ–±—ä—ë–º–∞–º–∏
- ‚ú® –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç mustCover —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- ‚ú® –ñ—ë—Å—Ç–∫–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ —Ñ–æ—Ä–º–∞—Ç–∞
- ‚ú® Few-shot –æ–±—É—á–µ–Ω–∏–µ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- ‚ú® –î–≤—É—Ö–ø—Ä–æ—Ö–æ–¥–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (draft ‚Üí refine)
- ‚ú® –ü–æ—Å—Ç-–ª–∏–Ω—Ç–µ—Ä –∫–∞—á–µ—Å—Ç–≤–∞
- ‚ú® –£–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä
- üîß –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏ (temperature, frequency_penalty, top_p)
- üìù –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**Backwards Compatible:** ‚úÖ –î–∞

